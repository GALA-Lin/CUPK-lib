## 管理的三个阶段的比较


|                | 人工管理阶段           | 文件系统阶段             | 数据库系统阶段                                             |
| ---------------- | ------------------------ | :------------------------- | ------------------------------------------------------------ |
| 应用背景       | 科学计算               | 科学计算、数据管理       | 大规模数据管理                                             |
| 硬件背景       | 无直接存储存储设备     | 磁盘、磁鼓               | 大容量磁盘，磁盘阵列                                       |
| 软件背景       | 无操作系统             | 有文件系统               | 有数据库管理系统                                           |
| 处理方式       | 批处理                 | 联机实时处理，批处理     | 联机实时处理，分布处理，批处理                             |
| 数据的管理者   | 用户（程序员）         | 文件系统                 | 数据库管理系统                                             |
| 数据面向的对象 | 某一应用程序           | 某一应用                 | 现实世界（一个部门、企业、跨国组织）                       |
| 数据的共享程度 | 无共享，冗余度极大     | 共享性差，冗余度大       | 共享性高、冗余度小                                         |
| 数据的独立性   | 不独立，完全依赖于程序 | 独立性差                 | 具有高度的物理独立性和一定的逻辑独立性                     |
| 数据的结构化   | 无结构                 | 记录内又结构，整体无结构 | 整体结构化，用数据模型描述                                 |
| 数据控制能力   | 应用程序自己控制       | 应用程序自己控制         | 由数据库管理系统提供数据安全性、完整性、并发控制和恢复能力 |

# 数据库的特点

* 数据结构化：数据库系统实现整体数据的结构化，是数据库系统与文件系统的本质区别
* 数据的共享性高、冗余度低且易扩充：数据共享可以大大减少数据冗余节约存储空间，数据共享还能够避免数据之间的不相容性和不一致性
* 数据独立性高：物理独立性和逻辑独立性。物理独立性是指用户的应用程序与数据库中的物理存储是相互独立的。逻辑独立性是指用户的应用程序与数据库的逻辑结构是相互独立的
* 数据由数据库管理系统统一管理和控制：数据的安全性保护，完整性检查，并发控制，数据库恢复

# 数据模型的组成要素

数据模型通常由数据结构、数据操作和数据的完整性约束条件三部分组成

其中，数据操作是指对数据库中的各种对象（型）的实例（值）允许执行的操作的集合，包括操作及有关的操作规则，主要有查询和更新两大类操作。数据操作是对系统动态特性的描述。

# 数据库系统的三级模式结构

数据库系统的三级模式结构由外模式、模式和内模式组成。

外模式：也称为子模式或者用户模式，是数据库用户能够看见和使用的局部数据的逻辑结构和特征的描述，是数据库用户的数据视图。

模式：也称为逻辑模式，是数据库中全体数据的逻辑结构和特性的描述，是所有用户的公共视图。模式描述的是数据的全局逻辑结构，外模式通常是模式的子集。

内模式：也称为存储模式，是指数据在数据库系统内部的表示，及对数据的物理结构和存储方式的描述。

为了能够在内部实现这三个抽相层次的联系和转换，数据库系统在这三级模式之间提供了两级映像：外模式/模式映像和模式/内模式映像。正是这两级映像保证了数据库系统中的数据能够具有较高的逻辑独立性和物理独立性

# 基本的关系操作

选择、投影、并、差、笛卡尔积是五种基本操作

# 关系的完整性

关系模式中有三类完整性约束：实体完整性，参照完整性，用户定义的完整性

# 传统的集合运算

# 专门的关系运算

# SQL的特点

* 综合统一：模式数据定义语言（模式DDL）
  数据操作=数据查询+数据操纵语言（DML）
  数据控制语言（DKL）
* 高度非过程化
* 面向集合的操作方式
* 以同一语法结构提供多种使用方式
* 语言简洁，易学易用

# SQL的基本概念

外模式：若干视图和部分基本表

模式：若干基本表

内模式：若干存储文件

# 范式、规范化

数据冗余

更新异常

插入异常

删除异常

码是关系模式中的一个重要的概念，要注意，超码包含候选码，从候选码中选出一个作为主码，包含在任何一个候选码中的属性称为主属性，不包含在任何一个候选码中的属性称为非主属性，整个属性组是码的情况称为全码

# 数据库设计的基本步骤

需求分析

概念结构设计

逻辑结构设计

物理结构设计

数据库实施

数据库运行和维护

# 数据模型的优化

数据库逻辑设计的结果不是唯一的

并不是规范化程度越高的关系就越优

对于一个具体应用来说，到底规范化到什么程度需要权衡响应时间和潜在问题两者的利弊决定

# 物理结构设计

为一个给定的逻辑数据模型选取一个最适合应用要求的物理结构的过程，就是数据库的物理设计

数据库的物理设计通常分为两步

确定数据库的物理结构

对物理结构进行评价

# 事物的基本概念 ACID 特性

事务是用户定义的一个数据库操作序列，这些操作要么全做，要么全不做，是一个不可分割的工作单位

事物具有四个特性，原子性(Atomicity)，一致性(Consistency)，隔离性(Isolation)，持续性(Durability)

原子性：事务是数据库的逻辑工作单位，事务中包括的诸操作要么都做，要么都不做。

一致性：事务执行的结果必须是使数据库从一个一致性状态变到另一个一致性状态。

隔离性：一个事务的执行不能被其他事务干扰，即一个事物内部的操作以及使用的数据对其他并发事务时隔离的，并发执行的各个事物之间不能互相干扰。

持续性：持续性也称永久性，指一个事务一旦提交，他对数据库中数据的改变就应该是永久性的，接下来的其他操作或故障不应该对其执行结果有任何影响。

故障恢复可以保证事务的原子性和持续性

# 数据库恢复

尽管数据库系统中采取了各种措施来防止数据库的安全性和完整性被破坏，保证并发事务的正确执行，但是计算机系统中硬件的故障，软件的错误，操作员的失误，以及恶意的破坏仍是不可避免的，这些故障轻则造成运行事务的非正常中断，重则破坏数据库，使数据库中全部或部分的数据丢失，因此数据库管理系统必须具有把数据库从错误状态恢复到某已知的正确状态的功能，这就是数据库的恢复

## 恢复实现技术

数据转储：定期的将整个数据库复制到磁带磁盘或其他存储介质上保存起来的过程，这些备用的数据称为后备副本

登记日志文件：日志文件是用来记录事务对数据库的更新操作的文件，每个日志记录的内容主要包括：事务标识，操作的类型，操作对象，更新前数据的旧值，更新后数据的新值，登记的次序必须严格按照并发事务执行的时间次序，必须先写日志文件，后写数据库

# 并发控制概述

* 丢失修改：是指两个事务T1.T2读入同一数据，各自进行修改，T2提交的结果破坏了T1提交的结果，导致T1的修改被丢失
* 脏读：俗称读脏数据，是指事务T1修改某一数据，并将其下写回磁盘，事务T2读取同一数据后，T1由于某种原因被撤销，这时T1修改过的数据恢复原值，T2读到的数据就与数据库中的数据不一致，则T2读到的数据就称为脏数据，即不正确的数据。
* 不可重复读：是指事务T1读取数据后，事务T2执行更新操作，当事务T1再次读取该数据时得到与前一次不同的数据。
* 幻读：也称作幻影现象，是指事务T1读取数据后，事务T2执行插入或删除操作，使T2无法再现前一次读取的结果

# 封锁

封锁是实现并发控制的一个非常重要的技术

排他锁又称为写锁：若事务T对数据对象A加上X锁，则只允许T读取和修改A，其他任事务都不能再对A加任何类型的锁，直到T释放A上的锁为止。这就保证了其他事务在释放之前不能读取和修改A。

共享锁又称为读锁，若事务T对数据A加上S锁，则事务T可以读A但不能修改A其他事务只能在对A加S锁，而不能加X锁，直到T释放A上的S锁为止，这就保证了其他事务可以读A但在释放之前不能修改A。

# 活锁和死锁

活锁：如果事务1封锁了数据r，事务2又请求封锁r，于是事务2进入等待，这时事务3也请求封锁r，当事务1释放了r之后，系统首先批准了事务3，事务2再次等待，如果这种情况一直出现，那么t2可能会一直等待，这种就是活锁，解决方法为，采用先来先服务

死锁：事务1封锁了r，事务2封锁了s，然后事务1请求封锁s，事务2请求封锁r，这时两个都将陷入等待，形成死锁。

预防死锁的方法：一次封锁法(一次性封锁所有需要封锁的数据)，顺序封锁法（按一定顺序进行封锁）

诊断死锁：超时法，等待图法

解决死锁：选择一个处理死锁代价最小的事件，将其撤销，释放此事务中的所有封锁
